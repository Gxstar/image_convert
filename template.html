<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>本地图片复制工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#6b7280',
                        accent: '#10b981'
                    }
                }
            }
        }
    </script>
    <style>
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            padding: 16px;
        }
        
        .image-card {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
        }
        
        .image-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .image-placeholder {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 150px;
        }
        
        .selected {
            outline: 3px solid #3b82f6;
            outline-offset: -3px;
        }
        
        .sidebar-button {
            transition: all 0.2s ease;
        }
        
        .sidebar-button:hover {
            background-color: #f3f4f6;
            transform: translateX(2px);
        }
        
        .drag-over {
            background-color: #dbeafe;
            border: 2px dashed #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-50 h-screen flex overflow-hidden">
    <!-- 侧边栏 -->
    <div class="w-64 bg-white shadow-lg flex flex-col">
        <div class="p-6 border-b border-gray-200">
            <h1 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
                <i class="fas fa-images text-primary"></i>
                图片复制工具
            </h1>
        </div>
        
        <div class="flex-1 p-4 space-y-4">
            <div class="space-y-2">
                <button id="addImagesBtn" class="sidebar-button w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left font-medium text-gray-700 hover:text-primary">
                    <i class="fas fa-file-image text-lg"></i>
                    <span>添加图片</span>
                </button>
                
                <button id="addFolderBtn" class="sidebar-button w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left font-medium text-gray-700 hover:text-primary">
                    <i class="fas fa-folder-plus text-lg"></i>
                    <span>添加文件夹</span>
                </button>
            </div>
            
            <div class="pt-4 border-t border-gray-200">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-semibold text-gray-700">操作</h3>
                    <span id="selectedCount" class="text-sm text-gray-500">0 选中</span>
                </div>
                
                <button id="copyBtn" class="w-full bg-primary hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-copy mr-2"></i>
                    复制选中图片
                </button>
                
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">目标路径</label>
                    <input type="text" id="targetPath" placeholder="选择或输入目标文件夹路径" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                    <button id="browseTargetBtn" class="mt-2 w-full text-sm text-primary hover:text-blue-600 font-medium">
                        <i class="fas fa-folder-open mr-2"></i>
                        浏览文件夹
                    </button>
                </div>
            </div>
        </div>
        
        <div class="p-4 border-t border-gray-200 text-xs text-gray-500">
            <p>支持 JPG, PNG, GIF, WEBP 格式</p>
        </div>
    </div>
    
    <!-- 主内容区域 -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <div class="bg-white border-b border-gray-200 p-4">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-gray-800">图片预览</h2>
                <div class="flex items-center gap-4 text-sm text-gray-600">
                    <span id="totalImages">0 张图片</span>
                    <button id="clearBtn" class="text-red-500 hover:text-red-700">
                        <i class="fas fa-trash mr-1"></i>清空
                    </button>
                </div>
            </div>
        </div>
        
        <div id="dropZone" class="flex-1 overflow-auto bg-gray-50">
            <div id="imageGrid" class="image-grid">
                <div id="emptyState" class="col-span-full flex flex-col items-center justify-center py-16 text-center">
                    <i class="fas fa-cloud-upload-alt text-6xl text-gray-300 mb-4"></i>
                    <h3 class="text-xl font-medium text-gray-600 mb-2">暂无图片</h3>
                    <p class="text-gray-500 mb-6">点击侧边栏按钮添加图片或文件夹</p>
                    <div class="flex gap-3">
                        <button id="emptyAddImages" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-file-image mr-2"></i>添加图片
                        </button>
                        <button id="emptyAddFolder" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                            <i class="fas fa-folder-plus mr-2"></i>添加文件夹
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="fileInput" accept="image/*" multiple class="hidden">
    <input type="file" id="folderInput" webkitdirectory directory multiple class="hidden">
    <input type="file" id="targetFolderInput" webkitdirectory directory class="hidden">

    <script>
        // 全局状态
        let selectedImages = new Set();
        let allImages = [];
        const supportedFormats = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'tiff'];
        
        // DOM 元素
        const elements = {
            addImagesBtn: document.getElementById('addImagesBtn'),
            addFolderBtn: document.getElementById('addFolderBtn'),
            copyBtn: document.getElementById('copyBtn'),
            clearBtn: document.getElementById('clearBtn'),
            targetPath: document.getElementById('targetPath'),
            browseTargetBtn: document.getElementById('browseTargetBtn'),
            fileInput: document.getElementById('fileInput'),
            folderInput: document.getElementById('folderInput'),
            targetFolderInput: document.getElementById('targetFolderInput'),
            imageGrid: document.getElementById('imageGrid'),
            emptyState: document.getElementById('emptyState'),
            totalImages: document.getElementById('totalImages'),
            selectedCount: document.getElementById('selectedCount'),
            dropZone: document.getElementById('dropZone')
        };
        
        // 初始化事件监听器
        function initEventListeners() {
            // 按钮点击事件
            elements.addImagesBtn.addEventListener('click', () => elements.fileInput.click());
            elements.addFolderBtn.addEventListener('click', () => elements.folderInput.click());
            elements.browseTargetBtn.addEventListener('click', () => elements.targetFolderInput.click());
            elements.copyBtn.addEventListener('click', copySelectedImages);
            elements.clearBtn.addEventListener('click', clearAllImages);
            
            // 空状态按钮
            document.getElementById('emptyAddImages').addEventListener('click', () => elements.fileInput.click());
            document.getElementById('emptyAddFolder').addEventListener('click', () => elements.folderInput.click());
            
            // 文件输入变化
            elements.fileInput.addEventListener('change', handleFileSelect);
            elements.folderInput.addEventListener('change', handleFolderSelect);
            elements.targetFolderInput.addEventListener('change', handleTargetFolderSelect);
            
            // 拖拽事件
            setupDragAndDrop();
        }
        
        // 处理文件选择
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            const validImages = files.filter(file => {
                const extension = file.name.split('.').pop().toLowerCase();
                return supportedFormats.includes(extension);
            });
            
            if (validImages.length > 0) {
                addImagesToGrid(validImages);
            }
            
            // 重置输入框
            event.target.value = '';
        }
        
        // 处理文件夹选择
        function handleFolderSelect(event) {
            const files = Array.from(event.target.files);
            const validImages = files.filter(file => {
                const extension = file.name.split('.').pop().toLowerCase();
                return supportedFormats.includes(extension);
            });
            
            if (validImages.length > 0) {
                addImagesToGrid(validImages);
            }
            
            event.target.value = '';
        }
        
        // 处理目标文件夹选择
        function handleTargetFolderSelect(event) {
            if (event.target.files.length > 0) {
                const folderPath = event.target.files[0].webkitRelativePath.split('/')[0];
                elements.targetPath.value = folderPath; // 实际应用中这里应该是完整路径
            }
            event.target.value = '';
        }
        
        // 添加图片到网格
        function addImagesToGrid(files) {
            elements.emptyState.style.display = 'none';
            
            files.forEach(file => {
                if (!allImages.some(img => img.name === file.name && img.size === file.size)) {
                    allImages.push(file);
                    createImageCard(file);
                }
            });
            
            updateStats();
        }
        
        // 创建图片卡片
        function createImageCard(file) {
            const card = document.createElement('div');
            card.className = 'image-card';
            card.dataset.fileId = `${file.name}-${file.size}`;
            
            const imgContainer = document.createElement('div');
            imgContainer.className = 'image-placeholder relative';
            
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.alt = file.name;
            img.className = 'w-full h-48 object-cover';
            img.loading = 'lazy';
            
            const overlay = document.createElement('div');
            overlay.className = 'absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center';
            
            const checkbox = document.createElement('div');
            checkbox.className = 'w-6 h-6 rounded-full border-2 border-white flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity';
            checkbox.innerHTML = '<i class="fas fa-check text-white text-xs"></i>';
            
            overlay.appendChild(checkbox);
            imgContainer.appendChild(img);
            imgContainer.appendChild(overlay);
            
            const info = document.createElement('div');
            info.className = 'p-3 bg-white';
            info.innerHTML = `
                <p class="font-medium text-sm text-gray-800 truncate">${file.name}</p>
                <p class="text-xs text-gray-500">${formatFileSize(file.size)}</p>
            `;
            
            card.appendChild(imgContainer);
            card.appendChild(info);
            
            // 点击事件
            card.addEventListener('click', (e) => {
                if (e.target.closest('.image-card')) {
                    toggleImageSelection(card, file);
                }
            });
            
            elements.imageGrid.appendChild(card);
        }
        
        // 切换图片选择状态
        function toggleImageSelection(card, file) {
            const fileId = `${file.name}-${file.size}`;
            
            if (selectedImages.has(fileId)) {
                selectedImages.delete(fileId);
                card.classList.remove('selected');
            } else {
                selectedImages.add(fileId);
                card.classList.add('selected');
            }
            
            updateStats();
        }
        
        // 更新统计信息
        function updateStats() {
            elements.totalImages.textContent = `${allImages.length} 张图片`;
            elements.selectedCount.textContent = `${selectedImages.size} 选中`;
            elements.copyBtn.disabled = selectedImages.size === 0 || !elements.targetPath.value.trim();
        }
        
        // 复制选中图片
        function copySelectedImages() {
            if (selectedImages.size === 0 || !elements.targetPath.value.trim()) {
                alert('请选择要复制的图片并指定目标路径');
                return;
            }
            
            // 在实际的Electron应用中，这里会调用Node.js的fs模块进行文件复制
            // 现在只是模拟操作
            alert(`将复制 ${selectedImages.size} 张图片到: ${elements.targetPath.value}`);
            
            // 清除选择
            selectedImages.clear();
            document.querySelectorAll('.image-card').forEach(card => {
                card.classList.remove('selected');
            });
            updateStats();
        }
        
        // 清空所有图片
        function clearAllImages() {
            if (allImages.length === 0) return;
            
            if (confirm('确定要清空所有图片吗？')) {
                allImages = [];
                selectedImages.clear();
                elements.imageGrid.innerHTML = '';
                elements.emptyState.style.display = 'flex';
                updateStats();
            }
        }
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // 设置拖拽功能
        function setupDragAndDrop() {
            const dropZone = elements.dropZone;
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('drag-over');
            }
            
            function unhighlight() {
                dropZone.classList.remove('drag-over');
            }
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                const validImages = Array.from(files).filter(file => {
                    const extension = file.name.split('.').pop().toLowerCase();
                    return supportedFormats.includes(extension);
                });
                
                if (validImages.length > 0) {
                    addImagesToGrid(validImages);
                }
            }
        }
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            initEventListeners();
            updateStats();
        });
    </script>
</body>
</html>